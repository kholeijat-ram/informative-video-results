<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive YouTube Video Quiz</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; }
  #player { margin: 20px auto; display: block; }
  #quizBox {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border: 2px solid #333;
    z-index: 1000;
    width: 300px;
  }
  #overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 900;
  }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h1>Interactive Video Quiz</h1>
<div id="player"></div>

<div id="overlay"></div>
<div id="quizBox">
  <h3 id="quizQuestion"></h3>
  <div id="quizOptions"></div>
  <button onclick="closeQuiz()">Close</button>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let INTERACTIONS = []; // will load from JSON
let player;
let quizShown = false;

// Load questions from JSON and pick random
async function loadQuestions() {
  try {
    const res = await fetch('questions.json');
    const allQuestions = await res.json();

    // Pick ONE random question
    const randomIndex = Math.floor(Math.random() * allQuestions.length);
    INTERACTIONS = [ allQuestions[randomIndex] ];

    console.log("Loaded questions:", INTERACTIONS);
  } catch (err) {
    console.error("Error loading questions.json:", err);
  }
}

// YouTube API setup
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '390',
    width: '640',
    videoId: 'YOUR_VIDEO_ID', // replace with your YouTube video ID
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  setInterval(checkVideoTime, 500);
}

function onPlayerStateChange(event) {}

// Check time and trigger quiz
function checkVideoTime() {
  if (!player || !INTERACTIONS.length) return;
  const currentTime = player.getCurrentTime();

  for (const quiz of INTERACTIONS) {
    if (!quizShown && currentTime >= quiz.time) {
      showQuiz(quiz);
      quizShown = true;
    }
  }
}

// Show quiz popup
function showQuiz(quiz) {
  document.getElementById('quizQuestion').innerText = quiz.question;
  const optionsContainer = document.getElementById('quizOptions');
  optionsContainer.innerHTML = '';
  quiz.options.forEach(option => {
    const btn = document.createElement('button');
    btn.innerText = option;
    btn.onclick = () => {
      if (option === quiz.answer) {
        alert("Correct!");
      } else {
        alert("Wrong answer.");
      }
      closeQuiz();
    };
    optionsContainer.appendChild(btn);
  });

  document.getElementById('overlay').style.display = 'block';
  document.getElementById('quizBox').style.display = 'block';
  player.pauseVideo();
}

// Close quiz
function closeQuiz() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('quizBox').style.display = 'none';
  player.playVideo();
}

// Load questions first
loadQuestions();
</script>

</body>
</html>
